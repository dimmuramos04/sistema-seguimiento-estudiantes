{% extends "base.html" %}

{% block title %}Editar Usuario: {{ usuario.username }}{% endblock %}

{% block content %}
    <h1>Editar Usuario: {{ usuario.username }}</h1>

    {# Mostrar mensajes flash #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category | default('info') }}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if usuario %}
    <form method="POST" action="{{ url_for('editar_usuario', id_usuario=usuario.id) }}">
        <div class="form-group">
            <label for="username_display">Nombre de Usuario (Login):</label>
            <input type="text" id="username_display" name="username_display" value="{{ usuario.username }}" readonly class="readonly-field">
            <small>El nombre de usuario no se puede cambiar desde este formulario.</small>
        </div>

        <hr>
        <h4>Cambiar Contrase単a (opcional)</h4>
        <div class="form-group">
            <label for="new_password">Nueva Contrase単a:</label>
            <input type="password" id="new_password" name="new_password">
            <small>Dejar en blanco para no cambiar la contrase単a actual.</small>
        </div>
        <div class="form-group">
            <label for="confirm_new_password">Confirmar Nueva Contrase単a:</label>
            <input type="password" id="confirm_new_password" name="confirm_new_password">
        </div>
        <hr>

        <div class="form-group">
            <label for="nombre_completo">Nombre Completo (para mostrar):</label>
            <input type="text" id="nombre_completo" name="nombre_completo" value="{{ usuario.nombre_completo if usuario.nombre_completo else '' }}" required>
        </div>

        <div class="form-group">
            <label for="rol">Rol del Usuario:</label>
            <select id="rol" name="rol" required>
                <option value="">Seleccione un rol...</option>
                {% for rol_opcion in lista_roles %}
                <option value="{{ rol_opcion }}" {% if usuario.rol == rol_opcion %}selected{% endif %}>{{ rol_opcion | capitalize }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <input type="checkbox" id="activo" name="activo" value="1" {% if usuario.activo == 1 %}checked{% endif %}>
            <label for="activo" style="font-weight: normal; display: inline;">Usuario Activo</label>
            <small>(Desmarcar para desactivar la cuenta)</small>
        </div>
        
        <div class="form-group" style="margin-top: 20px;">
            <input type="submit" value="Guardar Cambios" class="button button-primary">
            <a href="{{ url_for('admin_listar_usuarios') }}" class="button" style="background-color: #6c757d;">Cancelar</a>
        </div>
    </form>
    {% else %}
    <p>Usuario no encontrado.</p>
    {% endif %}
{% endblock %}